<html>
<head>
<link rel="stylesheet" href="themes/roleplay.graveyard/style.css" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="Shortcut Icon" href="favicon.png" />
<link rel="apple-touch-icon" href="iphone.png" />
<script type="text/javascript" src="zepto.js"></script>
<script type="text/javascript">
(function() {
	if ( navigator.platform === "iPad" ) {
		var scale = 1.2;
		document.write('<meta name="viewport" content="width=device-width; initial-scale='+scale+'; minimum-scale='+scale+'; maximum-scale='+scale+'; user-scalable=0;" />');

	} else if ( navigator.platform === "iPhone" ) {
		var scale = 1.0;
		document.write('<meta name="viewport" content="width=device-width; initial-scale='+scale+'; minimum-scale='+scale+'; maximum-scale='+scale+'; user-scalable=0;" />');

	} else if ( navigator.userAgent.indexOf("Android") != -1 ) {
		var scale = 1.2;
		document.write('<meta name="viewport" content="width=device-width; initial-scale-'+scale+'; minimum-scale='+scale+'; maximum-scale='+scale+'; user-scalable=0; target-densitydpi="device-dpi"; />');
	} else {
		return;
	}
})(); 


var clickMore = false;

// The last card.heading in the page is a hidden marker. If it can't be hidden
// by Javascript, it will display a "load more content" link that can be
// clicked to load additional content into the page, based on the state
// variable, which opening the page will change. If clicked, provide a
// "true" argument. Otherwise provide "false" to the function.
function addMoreContent(was_clicked) {
   clickMore = was_clicked;

   // Heading card named for the "tombstone" needs to get replaced
   var tombstone = document.getElementById('tombstone');

   // Replace tombstone with page contents
   var state = tombstone.querySelector('#state').innerHTML;

   // Add content into the page
   $.get(
      "/dev/?" + state,
       function (data) {
          $(".container").append(data);
       }
   );

   tombstone.id = "old_tombstone";
}


// Make all loading buttons show a "Loading..." state
function loadingButton() {
   // And add a listener to set the loading text for this and others
   document.getElementById('loadButton').addEventListener('click', function() {
      document.getElementById('loadButton').style.display = "none";
      document.getElementById('inProgress').style.display = "block";
   }, false);
}


// Once page has loaded, add new event listeners. When new cards are added to
// the page, run this code to regenerate tombstones and scrollstones that
// manage the loading of new content
$(function() {
   if ( document.getElementById('loadButton') != null ) {
      loadingButton();
   }

   // Detect when we loaded more content, and scroll to it if it was done via
   // a button click at the bottom of the page. Need a timeout value so that 
   // we scrollIntoView() only when all divs are finally rendered
   document.getElementById('container').addEventListener( 'DOMNodeInserted', function () {
      // If the bottom-of-page button was actually clicked, do a page-shift
      // so that it's clear the new content is finished loading.
      setTimeout(function () {
         var old_tombstone = document.getElementById('old_tombstone');
         if( clickMore == true ) {
            clickMore = false;
            // Go to an element next to the previous tombstone
            last_element = old_tombstone.previousElementSibling;
            // If last element was expanded, shrink it 
            shortener = last_element.querySelector('.showShort');
            if ( shortener ) { 
               if ( shortener.style.display == "none" ) {
                  revealToggle(last_element.id);
               }
            }
            last_element.scrollIntoView();
         }
         // Any old tombstones should be removed
         $("#old_tombstone").remove();
         $("#old_scrollstone").remove();
         // Any new divs should get topic links that are clickable
         activateTopicLinks();
         loadingButton();
      }, 200);
   }, false );

   // If we scrolled past the scrollstone itself, start adding new content
   window.addEventListener( 'scroll', function() {
      var scrollstone = document.getElementById('scrollstone');
      // If scrolled past the scrollstone, start loading data
      if ( document.body.scrollTop >= scrollstone.offsetTop ) {
         scrollstone.id = "old_scrollstone";
         addMoreContent(false);

         document.getElementById('loadButton').style.display = "none";
         document.getElementById('inProgress').style.display = "block";
      }
   });      

   // Make new topic links clickable and populate the search bar
   activateTopicLinks();

   // Process input into the search form
   $('#searchForm').submit(function() {
      var query = $('#searchEntry').val().trim();
      // Remove or escape any search processing characters here like commas
      $(".container").empty();

      // Create a now-searching div
      var loadingText = ''
      if ( query == '' ) {
         loadingText = document.createTextNode('Reshuffling...');
      } else {
         loadingText = document.createTextNode('Searching...');
      }
      var loading = document.createElement('div');
      loading.className = "card heading";
      loading.id = "search_waiting";
      var loadingContents = document.createElement('p');
      loadingContents.id = "loadButton";
      loadingContents.appendChild(loadingText);
      loading.appendChild(loadingContents);
      $(".container").append(loading);

      // Allow searches using special characters like #
      query = escape(query);

      // Load more data
      $("#searchForm").action = "/dev/?xs" + query;
      $.get(
         "/dev/?xs" + query,
          function (data) {
             // hack hack hack (length check)
             if ( data.length == 200 ) {
                var failedText = document.createTextNode('No results.');
                loadingContents.removeChild(loadingText);
                loadingContents.appendChild(failedText);
             } else {
                $(".container").empty();
                $(".container").append(data);
             }
          }
      );
   });
});


function activateTopicLinks() { 
   var linkList = document.getElementsByClassName('topicLink');
   for (var i = 0; i < linkList.length; i++ ) {
      linkList[i].addEventListener('click', function() {
         $('#searchEntry').val(this.text);
         $('#searchForm').submit();
      }, false);
   }
}

function revealToggle(id) {
   var card = document.getElementById(id);
   var largeImgs = card.querySelectorAll('.imgExpand')
   var expandLink = card.querySelector('.showShort')
   var expandDiv = card.querySelector('.divExpand')
   var todo = expandLink.style.display;

   if ( todo !== "none" ) {
      expandLink.style.display = "none";
      expandDiv.style.display = "block";
      for ( var i = 0; i < largeImgs.length; i++ ) {
         largeImgs[i].style.display = "block";
      }
   }
   else {
      expandLink.style.display = "inline";
      expandDiv.style.display = "none";
      for ( var i = 0; i < largeImgs.length; i++ ) {
         largeImgs[i].style.display = "none";
      }
   }
}

function createPost(id, mode) {
   var card = document.getElementById(id);
   var newPostCard = document.createElement('div');
   newPostCard.className = 'newPostCard';
   var reply = document.createElement('textarea');
   reply.className = "newThread";
   reply.required = true;

   // If reply already clicked, get rid of previous text boxes
   var nextElement = card.nextElementSibling;
   if ( nextElement.classList.contains("newPostCard") ) {
      card.nextSibling.remove();
   }
   if ( nextElement.classList.contains(mode) ) {
      return;   // Undraw, and call it good
   }

   reply.name = mode;
   newPostCard.classList.add(mode);
   if ( mode === "quote" ) {
      // Get body of the earlier message, and format it without nested
      // quotes. Only basic paragraphs (avoid pre/code/friends) TODO
      quotetext = card.childNodes[3].getElementsByClassName('postBody');
      // TODO: munge all paragraphs, and put it in a [QUOTE] tag.
      reply.defaultValue = quotetext[0].textContent;

   } else {
      reply.placeholder = "Add Your Reply!";
   }

   // Append edit menu afterwards
   var replyFooter = document.createElement('div');
   // TODO: not newthread class!
   replyFooter.className = "card rolldown newthread";
   var attachmentButton = document.createElement('input');
   attachmentButton.className = "threadFileInput";
   attachmentButton.type = "file";
   attachmentButton.name = "attachment";
   var submitButton = document.createElement('input');
   submitButton.className = "threadSubmit";
   submitButton.type = "submit";
   submitButton.name = "submit";
   replyFooter.appendChild(attachmentButton);
   replyFooter.appendChild(submitButton);

   newPostCard.appendChild(reply);
   newPostCard.appendChild(replyFooter);

   card.insertAdjacentElement('afterEnd', newPostCard);
}

</script>
</head>
<body>
<div style="display: block; height: 510px; max-height: 60%; width: 100%;">
</div>

<div id="container" class="container">

<div class="logo">
   <img class="logo" src="themes/roleplay.graveyard/logo.png" />
</div>

<div class="card forumMenu" id="menu">
   <div class="cell">
      <p class="forumMenuHeading">Latest Updates</p>
      <p class="forumMenu">New: 4 posts, 2 threads</p>
   </div>
   <div class="cell">
      <p class="forumMenuHeading">Settings</p>
      <p class="forumMenu">User: <i><u>@wumpwoast</u></i></p>
   </div>
   <div class="cell">
      <p class="forumMenuHeading">How to Use</p>
      <p class="forumMenu"><tt>:vrolijk_1:&nbsp;=&nbsp;<img style="display: inline; position: absolute; z-index: 2;" src="https://boil.afraid.org/forum/yabbfiles/Smilies/vrolijk_1.gif" /></tt></p>
   </div>
   <span><form><input id="searchMenuText" type="search" placeholder="Search Forum&hellip;"</input></form></span>
</div>

<div class="card settings" style="display: none;">
<form>
  <p style="text-align: center">Logged in as <i>@wumpwoast</i>. <button name="logOut">Log out</button></p>
  <p>You have 1945 posts since registering on <i>September&nbsp;16,&nbsp;2005.</i></p>
  <p><img class="settingsAvatar" src="cards/forum/avatars/wumpwoast.png"><input type="file" name="updateAvatar"></input></p>
  <p>
     <img class="settingsThemePreview" src="https://boil.afraid.org/dev/themes/roleplay.ruinedcastle/theme.png" />
     <img class="settingsThemePreview" src="https://boil.afraid.org/dev/themes/roleplay.cloudycastle/theme.png" />
     <img class="settingsThemePreview" src="https://boil.afraid.org/dev/themes/roleplay.graveyard/theme.png" />
  </p>
  <p>Refresh session cookie, good until <input type="date"></input>. Will expire on <i>March&nbsp;20,&nbsp;2017</i>.</p>
  <p>By default, posts land in the
    <select default="General">
      <option value="general">General</option>
      <option value="scrabble">Scrabble</option>
    </select> forum.</p>
  <p>When clicking a thread title,
    <select default="Expand All Posts">
      <option value="expandAll">Expand All Posts</option>
      <option value="showTen">Show Only the Latest 10 Posts</option>
    </select> by default.</p>
  <p>Posts younger than <input type="number" min="5" max="300" placeholder="120"></input> minutes can be revised.</p>
  <p style="text-align: center"><input type="Submit"></input> these updated settings.</p>
</form>
</div>

<div class="card help" style="display: none;">
<p>The boil.afraid.org forum is for all of Justin's friends to be able to share life and experiences, in a private and protected way. This is a quick starter guide for how the forum works &mdash; please consult the broader *manual*
for specifics.</p>

<p>This forum consists of several <i>channels</i> or sub-forums, in which people write <i>posts</i> that eventually
become larger <i>threads</i> of responses, organized by most-recently-updated. <i>Usernames</i> tend to be prefixed
with @, and channels tend to be prefixed with #.</p>

<p><b><i>Searching for posts</i></b> or forum content is context-aware, and usually case-insensitive:</p>
<ul>
  <li>Channel search and channel-filtered searches: <tt>#general</tt>, <tt>#Scrabble cheating</tt></li>
  <li>User search and user-filtered searches: <tt>@fbaggins</tt>, <tt>@faltydl music</tt></li>
  <li>Date-scoped searches: <tt>:since december:</tt>, <tt>:before 12/19/16:</tt></li>
</ul>

<p>To <b><i>create a thread</b></i>, fill in the textarea after the forum menu, starting with a thread title and a channel:</p>
<pre>
Sample Thread Title
#general

This is the message body of a sample post, including a [URL=http://www.codaworry.com]link to Codaworry[/URL].
</pre>

<p><b><i>Responding inside a thread</b></i> works the same way, only you don't need to specify the thread title or channel anymore. Just click <i>Reply</i> or <i>Quote</i> and write your message contents into the textarea.</p>

<p>To start a thread with a user-poll inside:</p>

<pre>
[POLL choices=1]
Sample Poll Thread Title
#general

Who would you vote for class president?
 * Cthulu
 * Neville Chamberlain
 * Red Panda
[/POLL]
</pre>
</div>


<div class="newPostCard">
<form>
  <textarea class="newThread" name="message" placeholder="Thread Title and Forum Name, one per line. Then, your message&hellip;"></textarea>

  <div class="card rolldown newThread">
    <input type="file" class="threadFileInput" name="attachment"></input>
    <input type="submit" class="threadSubmit" name="submit"></button>
  </div>
</form>
</div>

<div class="card forum odd fresh thread-1476249257" id="1476249257")>
<div class="cardTitle">
  <h2><img src="cards/forum/avatars/wumpwoast.png"><a href="#1476249257" onclick="revealToggle('1476249257');">An Example Forum Thread</a></h2>
  <p class="subject"><a class="topicLink" href="javascript:">@wumpwoast</a>, <a class="topicLink" href="javascript:">#general</a></p>
</div>

<div class="divExpand">
<pre>&nbsp; &nbsp; &nbsp; &nbsp; 82 letters remain<br /> &nbsp; 0 1 2 3 4 5 6 7 8 9 A B C D E<br /> &nbsp; - - - - - - - - - - - - - - -<br />0&#124; @ &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; @ &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; @ &#124;0 &nbsp;My Words:<br />1&#124; &nbsp; * &nbsp; &nbsp; &nbsp; + &nbsp; &nbsp; &nbsp; + &nbsp; &nbsp; &nbsp; * &nbsp; &#124;1 &nbsp; date(10)<br />2&#124; &nbsp; &nbsp; * &nbsp; &nbsp; &nbsp; - &nbsp; - &nbsp; &nbsp; &nbsp; * &nbsp; &nbsp; &#124;2<br />3&#124; - &nbsp; &nbsp; * &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; * &nbsp; &nbsp; - &#124;3<br />4&#124; &nbsp; &nbsp; &nbsp; &nbsp; * &nbsp; &nbsp; D &nbsp; &nbsp; * &nbsp; &nbsp; &nbsp; &nbsp; &#124;4<br />5&#124; &nbsp; + &nbsp; &nbsp; &nbsp; + &nbsp; A &nbsp; + &nbsp; &nbsp; &nbsp; + &nbsp; &#124;5<br />6&#124; &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; - T - &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; &#124;6<br />7&#124; @ &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; E &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; @ &#124;7<br />8&#124; &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; - &nbsp; - &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; &#124;8 &nbsp;Your Words:<br />9&#124; &nbsp; + &nbsp; &nbsp; &nbsp; + &nbsp; &nbsp; &nbsp; + &nbsp; &nbsp; &nbsp; + &nbsp; &#124;9<br />A&#124; &nbsp; &nbsp; &nbsp; &nbsp; * &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * &nbsp; &nbsp; &nbsp; &nbsp; &#124;A<br />B&#124; - &nbsp; &nbsp; * &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; * &nbsp; &nbsp; - &#124;B<br />C&#124; &nbsp; &nbsp; * &nbsp; &nbsp; &nbsp; - &nbsp; - &nbsp; &nbsp; &nbsp; * &nbsp; &nbsp; &#124;C<br />D&#124; &nbsp; * &nbsp; &nbsp; &nbsp; + &nbsp; &nbsp; &nbsp; + &nbsp; &nbsp; &nbsp; * &nbsp; &#124;D<br />E&#124; @ &nbsp; &nbsp; - &nbsp; &nbsp; &nbsp; @ &nbsp; &nbsp; &nbsp; - &nbsp; &nbsp; @ &#124;E<br /> &nbsp; - - - - - - - - - - - - - - -<br /> &nbsp; 0 1 2 3 4 5 6 7 8 9 A B C D E<br /><br /> me:10 &nbsp; &nbsp; G D I N U S N &nbsp; you:0<br /></pre>
 
<p class="postBody">Sometimes failures are more interesting than successes. Last week marked the end of my focused efforts on the Gapless-5 library. Properly implemented, this library would enable a web jukebox to playing multiple songs in order, without audible gaps in between the songs. <a href="#" class="showShort"></a></p>

   <div class="cardFooter">
      <div class="bottom">
         <p class="cardNav"><u><a onclick="createPost('1476249257', 'reply');">Reply</a></u>&nbsp;<u><a onclick="createPost('1476249257', 'quote');">Quote</a></u> <a href="/public_html/?xn1476249257">Thread</a>&nbsp;<a href="/public_html/?xn=1476249257">Post</a></p>
         <p class="postDate">3 days ago</p>
      </div>
   </div>
</div>
</div>

<div class="card forum even thread-1476249257" id="13241234a">
<div class="cardTitle">
  <h5><img src="cards/forum/avatars/wumpwoast.png"><a href="#">@wumpwoast</a> &middot; #2/12</h5>
</div>

<p class="postBody">This is a response.</p>

   <div class="cardFooter">
      <div class="bottom">
         <p class="cardNav"><u><a href="#">Reply</a></u>&nbsp;<u><a href="#">Quote</a></u> <a href="/public_html/?xn1476249257">Post</a></p>
         <p class="postDate">October 11, 2016</p>
      </div>
   </div>
</div>

<div class="card forum odd thread-1476249257" id="13241234b">
<div class="cardTitle">
  <h5><img src="cards/forum/avatars/wumpwoast.png"><a href="#">@wumpwoast</a> &middot; #3/12 (R1)</h5>
</div>

   <div class="cardQuote"><p class="quote">This is a response.</p><p class="attribution">@wumpwoast</p></div>
<p class="postBody">This is a response that has been modified once. It has a quote and a song attached.</p>

<p class="attachment"><img class="attachmentIcon" src="images/mimetypes/audio.png" /><a href="some-attachment-file.mp3">some-attachment-file.mp3</a></p>

   <div class="cardFooter">
      <div class="bottom">
         <p class="cardNav"><u><a href="#">Reply</a></u>&nbsp;<u><a href="#">Quote</a></u> <a href="/public_html/?xn1476249257">Post</a></p>
         <p class="postDate">October 15, 2016</p>
      </div>
   </div>
</div>

<div class="card forum even thread-1476249257" id="13241234c">
<div class="cardTitle">
  <h5><img src="cards/forum/avatars/wumpwoast.png"><a href="#">@wumpwoast</a> &middot; #4/12</h5>
</div>

   <div class="cardQuote"><p class="quote">This is a response, in a quote. It's really long, so you can see what the quoting style will eventually look like on a bigger card.</p><p class="attribution">@wumpwoast</p></div>
   <p class="postBody">This is a response. A really long response that could conflict or wrap around the little date tag, if we didn't have a full footer bar.</p>

   <div class="cardFooter">
      <div class="bottom">
         <p class="cardNav"><u><a href="#">Reply</a></u>&nbsp;<u><a href="#">Quote</a></u> <a href="/public_html/?xn1476249257">Post</a></p>
         <p class="postDate">October 11, 2016</p>
      </div>
   </div>
</div>

<div class="card forum odd thread-1476249257" id="13241234d">
<div class="cardTitle">
  <h5><img src="cards/forum/avatars/wumpwoast.png"><a href="#">@wumpwoast</a> &middot; #5/12</h5>
</div>

<p class="postBody">This is a response with an image attachment.</p>

<p class="attachment"><img class="attachmentIcon" src="images/mimetypes/jpg.png" /><a href="cards/forum/pictures/ruined-castle-background.jpg">ruined-castle-background.jpg</a></p>

<img class="attachmentImage" src="cards/forum/pictures/ruined-castle-background.jpg" />

   <div class="cardFooter">
      <div class="bottom">
         <p class="cardNav"><u><a href="#">Reply</a></u>&nbsp;<u><a href="#">Quote</a></u> <a href="/public_html/?xn1476249257">Post</a></p>
         <p class="postDate">October 11, 2016</p>
      </div>
   </div>
</div>

<div class="card forumMenu">
   <span>An Example Forum Thread: 6 Posts Still Unloaded</span>
   <div class="cell">
      <p class="forumMenuHeading">Expand All</p>
   </div>
   <div class="cell">
      <p class="forumMenuHeading">Latest Posts</p>
   </div>
   <div class="cell">
      <p class="forumMenuHeading">Shrink All</p>
   </div>
</div>

<div class="card forum odd thread-1476249000" id="1476249000")>
<div class="cardTitle">
  <h2><img src="cards/forum/avatars/wumpwoast.png" /><a href="#1476249257" onclick="revealToggle('1476249257');">Welcome to the new Codaworry forum</a></h2>
  <p class="subject"><a class="topicLink" href="javascript:">@wumpwoast</a>, <a class="topicLink" href="javascript:">#general</a></p>
</div>

<p class="postBody">This is a post that has been expanded, but has no replies.</p>

   <div class="cardFooter">
      <div class="bottom">
         <p class="cardNav"><u><a href="#">Reply</a></u>&nbsp;<u><a href="#">Quote</a></u> <a href="/public_html/?xn1476249257">Thread</a>&nbsp;<a href="/public_html/?xn=1476249257">Post</a></p>
         <p class="postDate">1 week ago</p>
      </div>
   </div>
</div>


<div class="card forum even thread-1476200000" id="1476200000")>
<div class="cardTitle">
  <h2><img src="cards/forum/avatars/wumpwoast.png"><a href="#1476249257" onclick="revealToggle('1476249257');">Follow the rules or else</a></h2>
  <p class="subject"><a class="topicLink" href="javascript:">@wumpwoast</a>, <a class="topicLink" href="javascript:">#scrabble</a></p>
</div>
</div>


   <!-- Contents go here -->

</div>
</body>
</html>
